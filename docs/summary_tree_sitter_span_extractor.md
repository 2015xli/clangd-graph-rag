# Algorithm Summary: `tree_sitter_span_extractor.py`

## 1. Role in the Pipeline

This script acts as a **library module**. Its sole responsibility is to parse C/C++ source files and provide the precise location (span) of every function's body.

This information is essential for the call graph building process, as it allows the pipeline to determine which function (the caller) contains a specific function call.

The script provides the `SpanExtractor` class, which encapsulates all the necessary parsing logic.

## 2. Core Technology

The script is built upon the **`tree-sitter`** parsing framework.

- **Parser Initialization**: It uses `tree-sitter-c` to get the C language grammar. A `Parser` instance is configured with this grammar to build a concrete syntax tree from the source code.

- **AST Traversal**: The core of the algorithm involves traversing the Abstract Syntax Tree (AST) generated by `tree-sitter`. This allows the script to reliably identify `function_definition` nodes based on the C grammar, making it robust against formatting variations.

## 3. Key Methods & Output

### `get_function_spans_from_folder(folder, format="dict")`

This is the primary method used by the pipeline.

1.  It recursively walks the provided project folder to find all `.c` and `.h` files.
2.  For each file, it uses the `tree-sitter` parser to build an AST.
3.  It traverses the AST, finds all `function_definition` nodes, and extracts the start and end coordinates for both the function's name and its body.
4.  **File-Grouped Output**: It returns a list of dictionaries. Each dictionary represents a single **file** and has two keys:
    *   `FileURI`: The URI of the file.
    *   `Functions`: A list containing all the function spans found within that file.

This structure is more organized and efficient for downstream consumers.

## 4. Memory Optimization

The script has been optimized to keep memory usage low, which is critical when parsing thousands of files.

-   **Relative Locations**: The location data for each function (`NameLocation`, `BodyLocation`) is stored relative to the file it's in. The `FileURI` is not duplicated for every single function, but stored only once per file, saving significant memory.
-   **Explicit Garbage Collection**: After a file's source code and syntax tree are processed, they are explicitly deleted and the garbage collector is invoked. This ensures that memory from large source files is reclaimed as quickly as possible, preventing memory spikes.
